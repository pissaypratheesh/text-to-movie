{"version":3,"file":"generateMultiTextureShader.js","names":["fragTemplate","join","generateMultiTextureShader","gl","maxTextures","vertexSrc","fragmentSrc","replace","generateSampleSrc","shader","Shader","sampleValues","i","bind","uniforms","uSamplers","src"],"sources":["../../../src/sprites/webgl/generateMultiTextureShader.js"],"sourcesContent":["import Shader from '../../Shader';\nimport { readFileSync } from 'fs';\nimport { join } from 'path';\n\nconst fragTemplate = [\n    'varying vec2 vTextureCoord;',\n    'varying vec4 vColor;',\n    'varying float vTextureId;',\n    'uniform sampler2D uSamplers[%count%];',\n\n    'void main(void){',\n    'vec4 color;',\n    '%forloop%',\n    'gl_FragColor = color * vColor;',\n    '}',\n].join('\\n');\n\nexport default function generateMultiTextureShader(gl, maxTextures)\n{\n    const vertexSrc = readFileSync(join(__dirname, './texture.vert'), 'utf8');\n    let fragmentSrc = fragTemplate;\n\n    fragmentSrc = fragmentSrc.replace(/%count%/gi, maxTextures);\n    fragmentSrc = fragmentSrc.replace(/%forloop%/gi, generateSampleSrc(maxTextures));\n\n    const shader = new Shader(gl, vertexSrc, fragmentSrc);\n\n    const sampleValues = [];\n\n    for (let i = 0; i < maxTextures; i++)\n    {\n        sampleValues[i] = i;\n    }\n\n    shader.bind();\n    shader.uniforms.uSamplers = sampleValues;\n\n    return shader;\n}\n\nfunction generateSampleSrc(maxTextures)\n{\n    let src = '';\n\n    src += '\\n';\n    src += '\\n';\n\n    for (let i = 0; i < maxTextures; i++)\n    {\n        if (i > 0)\n        {\n            src += '\\nelse ';\n        }\n\n        if (i < maxTextures - 1)\n        {\n            src += `if(vTextureId < ${i}.5)`;\n        }\n\n        src += '\\n{';\n        src += `\\n\\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`;\n        src += '\\n}';\n    }\n\n    src += '\\n';\n    src += '\\n';\n\n    return src;\n}\n"],"mappings":";;;;;;AAAA;AAEA;AAA4B;AAE5B,IAAMA,YAAY,GAAG,CACjB,6BAA6B,EAC7B,sBAAsB,EACtB,2BAA2B,EAC3B,uCAAuC,EAEvC,kBAAkB,EAClB,aAAa,EACb,WAAW,EACX,gCAAgC,EAChC,GAAG,CACN,CAACC,IAAI,CAAC,IAAI,CAAC;AAEG,SAASC,0BAA0B,CAACC,EAAE,EAAEC,WAAW,EAClE;EACI,IAAMC,SAAS,4cAA0D;EACzE,IAAIC,WAAW,GAAGN,YAAY;EAE9BM,WAAW,GAAGA,WAAW,CAACC,OAAO,CAAC,WAAW,EAAEH,WAAW,CAAC;EAC3DE,WAAW,GAAGA,WAAW,CAACC,OAAO,CAAC,aAAa,EAAEC,iBAAiB,CAACJ,WAAW,CAAC,CAAC;EAEhF,IAAMK,MAAM,GAAG,IAAIC,eAAM,CAACP,EAAE,EAAEE,SAAS,EAAEC,WAAW,CAAC;EAErD,IAAMK,YAAY,GAAG,EAAE;EAEvB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,WAAW,EAAEQ,CAAC,EAAE,EACpC;IACID,YAAY,CAACC,CAAC,CAAC,GAAGA,CAAC;EACvB;EAEAH,MAAM,CAACI,IAAI,EAAE;EACbJ,MAAM,CAACK,QAAQ,CAACC,SAAS,GAAGJ,YAAY;EAExC,OAAOF,MAAM;AACjB;AAEA,SAASD,iBAAiB,CAACJ,WAAW,EACtC;EACI,IAAIY,GAAG,GAAG,EAAE;EAEZA,GAAG,IAAI,IAAI;EACXA,GAAG,IAAI,IAAI;EAEX,KAAK,IAAIJ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,WAAW,EAAEQ,CAAC,EAAE,EACpC;IACI,IAAIA,CAAC,GAAG,CAAC,EACT;MACII,GAAG,IAAI,SAAS;IACpB;IAEA,IAAIJ,CAAC,GAAGR,WAAW,GAAG,CAAC,EACvB;MACIY,GAAG,yBAAuBJ,CAAC,QAAK;IACpC;IAEAI,GAAG,IAAI,KAAK;IACZA,GAAG,yCAAuCJ,CAAC,uBAAoB;IAC/DI,GAAG,IAAI,KAAK;EAChB;EAEAA,GAAG,IAAI,IAAI;EACXA,GAAG,IAAI,IAAI;EAEX,OAAOA,GAAG;AACd"}