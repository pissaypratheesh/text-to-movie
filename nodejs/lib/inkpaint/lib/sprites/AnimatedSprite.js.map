{"version":3,"file":"AnimatedSprite.js","names":["AnimatedSprite","Sprite","constructor","textures","autoUpdate","Texture","texture","_textures","_durations","_autoUpdate","animationSpeed","loop","updateAnchor","onComplete","onFrameChange","onLoop","_currentTime","playing","stop","shared","remove","update","play","add","UPDATE_PRIORITY","HIGH","gotoAndStop","frameNumber","previousFrame","currentFrame","updateTexture","gotoAndPlay","deltaTime","elapsed","lag","sign","Maths","Math","floor","length","_texture","_textureID","cachedTint","_anchor","copy","defaultAnchor","destroy","options","fromFrames","frames","i","push","fromFrame","fromImages","images","fromImage","totalFrames","value","time"],"sources":["../../src/sprites/AnimatedSprite.js"],"sourcesContent":["import Sprite from \"./Sprite\";\nimport { shared } from \"../ticker\";\nimport Maths from \"../math/Maths\";\nimport Texture from \"../textures/Texture\";\nimport { UPDATE_PRIORITY } from \"../const\";\n\nexport default class AnimatedSprite extends Sprite {\n  constructor(textures, autoUpdate) {\n    super(textures[0] instanceof Texture ? textures[0] : textures[0].texture);\n\n    this._textures = null;\n    this._durations = null;\n    this.textures = textures;\n    this._autoUpdate = autoUpdate !== false;\n    this.animationSpeed = 1;\n    this.loop = true;\n    this.updateAnchor = false;\n    this.onComplete = null;\n    this.onFrameChange = null;\n    this.onLoop = null;\n    this._currentTime = 0;\n    this.playing = false;\n  }\n\n  stop() {\n    if (!this.playing) return;\n\n    this.playing = false;\n    if (this._autoUpdate) {\n      shared.remove(this.update, this);\n    }\n  }\n\n  play() {\n    if (this.playing) return;\n\n    this.playing = true;\n    if (this._autoUpdate) {\n      shared.add(this.update, this, UPDATE_PRIORITY.HIGH);\n    }\n  }\n\n  gotoAndStop(frameNumber) {\n    this.stop();\n\n    const previousFrame = this.currentFrame;\n    this._currentTime = frameNumber;\n\n    if (previousFrame !== this.currentFrame) {\n      this.updateTexture();\n    }\n  }\n\n  gotoAndPlay(frameNumber) {\n    const previousFrame = this.currentFrame;\n\n    this._currentTime = frameNumber;\n    if (previousFrame !== this.currentFrame) {\n      this.updateTexture();\n    }\n\n    this.play();\n  }\n\n  update(deltaTime) {\n    const elapsed = this.animationSpeed * deltaTime;\n    const previousFrame = this.currentFrame;\n\n    if (this._durations !== null) {\n      let lag = (this._currentTime % 1) * this._durations[this.currentFrame];\n      lag += (elapsed / 60) * 1000;\n\n      while (lag < 0) {\n        this._currentTime--;\n        lag += this._durations[this.currentFrame];\n      }\n\n      const sign = Maths.sign(this.animationSpeed * deltaTime);\n      this._currentTime = Math.floor(this._currentTime);\n\n      while (lag >= this._durations[this.currentFrame]) {\n        lag -= this._durations[this.currentFrame] * sign;\n        this._currentTime += sign;\n      }\n\n      this._currentTime += lag / this._durations[this.currentFrame];\n    } else {\n      this._currentTime += elapsed;\n    }\n\n    if (this._currentTime < 0 && !this.loop) {\n      this.gotoAndStop(0);\n\n      if (this.onComplete) {\n        this.onComplete();\n      }\n    } else if (this._currentTime >= this._textures.length && !this.loop) {\n      this.gotoAndStop(this._textures.length - 1);\n\n      if (this.onComplete) {\n        this.onComplete();\n      }\n    } else if (previousFrame !== this.currentFrame) {\n      if (this.loop && this.onLoop) {\n        if (this.animationSpeed > 0 && this.currentFrame < previousFrame) {\n          this.onLoop();\n        } else if (\n          this.animationSpeed < 0 &&\n          this.currentFrame > previousFrame\n        ) {\n          this.onLoop();\n        }\n      }\n\n      this.updateTexture();\n    }\n  }\n\n  updateTexture() {\n    this._texture = this._textures[this.currentFrame];\n    this._textureID = -1;\n    this.cachedTint = 0xffffff;\n\n    if (this.updateAnchor) {\n      this._anchor.copy(this._texture.defaultAnchor);\n    }\n\n    if (this.onFrameChange) {\n      this.onFrameChange(this.currentFrame);\n    }\n  }\n\n  destroy(options) {\n    this.stop();\n    super.destroy(options);\n  }\n\n  static fromFrames(frames) {\n    const textures = [];\n\n    for (let i = 0; i < frames.length; ++i) {\n      textures.push(Texture.fromFrame(frames[i]));\n    }\n\n    return new AnimatedSprite(textures);\n  }\n\n  static fromImages(images) {\n    const textures = [];\n\n    for (let i = 0; i < images.length; ++i) {\n      textures.push(Texture.fromImage(images[i]));\n    }\n\n    return new AnimatedSprite(textures);\n  }\n\n  get totalFrames() {\n    return this._textures.length;\n  }\n\n  get textures() {\n    return this._textures;\n  }\n\n  set textures(value) {\n    if (value[0] instanceof Texture) {\n      this._textures = value;\n      this._durations = null;\n    } else {\n      this._textures = [];\n      this._durations = [];\n\n      for (let i = 0; i < value.length; i++) {\n        this._textures.push(value[i].texture);\n        this._durations.push(value[i].time);\n      }\n    }\n    this.gotoAndStop(0);\n    this.updateTexture();\n  }\n\n  get currentFrame() {\n    let currentFrame = Math.floor(this._currentTime) % this._textures.length;\n    if (currentFrame < 0) {\n      currentFrame += this._textures.length;\n    }\n\n    return currentFrame;\n  }\n}\n"],"mappings":"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"}