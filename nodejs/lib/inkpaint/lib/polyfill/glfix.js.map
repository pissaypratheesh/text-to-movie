{"version":3,"file":"glfix.js","names":["GLFix","fixGetUniformLocation","ctx","_getUniformLocation","getUniformLocation","program","name","_uniforms","test","reg","RegExp","i","length","_name","call","fixTexImage2D","_tetImage2D","texImage2D"],"sources":["../../src/polyfill/glfix.js"],"sourcesContent":["const GLFix = {\n  // Temporary fix https://github.com/stackgl/headless-gl/issues/170\n  fixGetUniformLocation(ctx) {\n    const _getUniformLocation = ctx.getUniformLocation;\n\n    ctx.getUniformLocation = function(program, name) {\n      if (program._uniforms && !/\\[\\d+\\]$/.test(name)) {\n        const reg = new RegExp(`${name}\\\\[\\\\d+\\\\]$`);\n\n        for (let i = 0; i < program._uniforms.length; i++) {\n          const _name = program._uniforms[i].name;\n          if (reg.test(_name)) name = _name;\n        }\n      }\n\n      return _getUniformLocation.call(this, program, name);\n    };\n  },\n\n  fixTexImage2D(ctx) {\n    const _tetImage2D = ctx.texImage2D;\n\n    // ctx.texImage2D = function(...args) {\n    //   let pixels = args[args.length - 1];\n    //   if (pixels._image) pixels = pixels._image;\n\n    //   if (pixels instanceof Image) {\n    //     const canvas = new Canvas(pixels.width, pixels.height);\n    //     canvas.getContext(\"2d\").drawImage(pixels, 0, 0);\n    //     args[args.length - 1] = canvas;\n    //   }\n\n    //   return _tetImage2D.apply(this, args);\n    // };\n  }\n};\n\nexport default GLFix;\n"],"mappings":";;;;;;AAAA,IAAMA,KAAK,GAAG;EACZ;EACAC,qBAAqB,CAACC,GAAG,EAAE;IACzB,IAAMC,mBAAmB,GAAGD,GAAG,CAACE,kBAAkB;IAElDF,GAAG,CAACE,kBAAkB,GAAG,UAASC,OAAO,EAAEC,IAAI,EAAE;MAC/C,IAAID,OAAO,CAACE,SAAS,IAAI,CAAC,UAAU,CAACC,IAAI,CAACF,IAAI,CAAC,EAAE;QAC/C,IAAMG,GAAG,GAAG,IAAIC,MAAM,CAAIJ,IAAI,iBAAc;QAE5C,KAAK,IAAIK,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGN,OAAO,CAACE,SAAS,CAACK,MAAM,EAAED,CAAC,EAAE,EAAE;UACjD,IAAME,KAAK,GAAGR,OAAO,CAACE,SAAS,CAACI,CAAC,CAAC,CAACL,IAAI;UACvC,IAAIG,GAAG,CAACD,IAAI,CAACK,KAAK,CAAC,EAAEP,IAAI,GAAGO,KAAK;QACnC;MACF;MAEA,OAAOV,mBAAmB,CAACW,IAAI,CAAC,IAAI,EAAET,OAAO,EAAEC,IAAI,CAAC;IACtD,CAAC;EACH,CAAC;EAEDS,aAAa,CAACb,GAAG,EAAE;IACjB,IAAMc,WAAW,GAAGd,GAAG,CAACe,UAAU;;IAElC;IACA;IACA;;IAEA;IACA;IACA;IACA;IACA;;IAEA;IACA;EACF;AACF,CAAC;AAAC,eAEajB,KAAK;AAAA"}