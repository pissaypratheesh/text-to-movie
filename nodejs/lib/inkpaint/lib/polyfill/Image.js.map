{"version":3,"file":"Image.js","names":["myCanvas","PsImage","poly","CImage","constructor","isPsImage","addEventListener","name","cb","_eventemitter","EventEmitter","once","convertToImageData","image","flip","width","height","createCanvas","ctx","getContext","scale","translate","clearRect","drawImage","getImageData","convertToCanvas","imgData","can","putImageData","isBrowser","window","Image"],"sources":["../../src/polyfill/Image.js"],"sourcesContent":["import poly from \"./poly\";\nimport { createCanvas, Image as CImage } from \"../canvas-gl\";\nimport EventEmitter from \"eventemitter3\";\nimport { isBrowser } from \"browser-or-node\";\n\nlet myCanvas;\nclass PsImage extends poly(CImage) {\n  constructor(...args) {\n    super(...args);\n    this.isPsImage = true;\n  }\n\n  addEventListener(name, cb) {\n    if (!this._eventemitter) {\n      this._eventemitter = new EventEmitter();\n    }\n\n    this._eventemitter.once(name, cb);\n  }\n\n  static convertToImageData(image, flip = false) {\n    const { width, height } = image;\n\n    if (!myCanvas) myCanvas = createCanvas(width, height);\n    myCanvas.width = width;\n    myCanvas.height = height;\n    const ctx = myCanvas.getContext(\"2d\");\n\n    if (flip) {\n      ctx.scale(1, -1);\n      ctx.translate(0, -height);\n    }\n\n    ctx.clearRect(width, height);\n    ctx.drawImage(image, 0, 0);\n    return ctx.getImageData(0, 0, width, height);\n  }\n\n  static convertToCanvas(imgData, width, height) {\n    const can = createCanvas(width, height);\n    const ctx = can.getContext(\"2d\");\n    ctx.putImageData(imgData, 0, 0);\n    return can;\n  }\n}\n\nexport default isBrowser ? window.Image : PsImage;\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AAA4C;AAE5C,IAAIA,QAAQ;AACZ,MAAMC,OAAO,SAAS,IAAAC,aAAI,EAACC,eAAM,CAAC,CAAC;EACjCC,WAAW,GAAU;IACnB,KAAK,CAAC,YAAO,CAAC;IACd,IAAI,CAACC,SAAS,GAAG,IAAI;EACvB;EAEAC,gBAAgB,CAACC,IAAI,EAAEC,EAAE,EAAE;IACzB,IAAI,CAAC,IAAI,CAACC,aAAa,EAAE;MACvB,IAAI,CAACA,aAAa,GAAG,IAAIC,qBAAY,EAAE;IACzC;IAEA,IAAI,CAACD,aAAa,CAACE,IAAI,CAACJ,IAAI,EAAEC,EAAE,CAAC;EACnC;EAEA,OAAOI,kBAAkB,CAACC,KAAK,EAAEC,IAAI,EAAU;IAAA,IAAdA,IAAI;MAAJA,IAAI,GAAG,KAAK;IAAA;IAC3C,IAAM;MAAEC,KAAK;MAAEC;IAAO,CAAC,GAAGH,KAAK;IAE/B,IAAI,CAACb,QAAQ,EAAEA,QAAQ,GAAG,IAAAiB,sBAAY,EAACF,KAAK,EAAEC,MAAM,CAAC;IACrDhB,QAAQ,CAACe,KAAK,GAAGA,KAAK;IACtBf,QAAQ,CAACgB,MAAM,GAAGA,MAAM;IACxB,IAAME,GAAG,GAAGlB,QAAQ,CAACmB,UAAU,CAAC,IAAI,CAAC;IAErC,IAAIL,IAAI,EAAE;MACRI,GAAG,CAACE,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MAChBF,GAAG,CAACG,SAAS,CAAC,CAAC,EAAE,CAACL,MAAM,CAAC;IAC3B;IAEAE,GAAG,CAACI,SAAS,CAACP,KAAK,EAAEC,MAAM,CAAC;IAC5BE,GAAG,CAACK,SAAS,CAACV,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;IAC1B,OAAOK,GAAG,CAACM,YAAY,CAAC,CAAC,EAAE,CAAC,EAAET,KAAK,EAAEC,MAAM,CAAC;EAC9C;EAEA,OAAOS,eAAe,CAACC,OAAO,EAAEX,KAAK,EAAEC,MAAM,EAAE;IAC7C,IAAMW,GAAG,GAAG,IAAAV,sBAAY,EAACF,KAAK,EAAEC,MAAM,CAAC;IACvC,IAAME,GAAG,GAAGS,GAAG,CAACR,UAAU,CAAC,IAAI,CAAC;IAChCD,GAAG,CAACU,YAAY,CAACF,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC;IAC/B,OAAOC,GAAG;EACZ;AACF;AAAC,eAEcE,wBAAS,GAAGC,MAAM,CAACC,KAAK,GAAG9B,OAAO;AAAA"}