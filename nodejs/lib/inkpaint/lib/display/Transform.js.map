{"version":3,"file":"Transform.js","names":["Transform","TransformBase","constructor","position","Point","scale","skew","ObservablePoint","updateSkew","pivot","_rotation","_cx","_sx","_cy","_sy","Math","cos","_y","sin","_x","updateLocalTransform","lt","localTransform","a","x","b","c","y","d","tx","ty","updateTransform","parentTransform","pt","worldTransform","wt","_worldID","setFromMatrix","matrix","decompose","rotation","value"],"sources":["../../src/display/Transform.js"],"sourcesContent":["import { Point, ObservablePoint } from \"../math\";\nimport TransformBase from \"./TransformBase\";\n\nexport default class Transform extends TransformBase {\n  constructor() {\n    super();\n\n    this.position = new Point(0, 0);\n    this.scale = new Point(1, 1);\n    this.skew = new ObservablePoint(this.updateSkew, this, 0, 0);\n    this.pivot = new Point(0, 0);\n    this._rotation = 0;\n\n    this._cx = 1; // cos rotation + skewY;\n    this._sx = 0; // sin rotation + skewY;\n    this._cy = 0; // cos rotation + Math.PI/2 - skewX;\n    this._sy = 1; // sin rotation + Math.PI/2 - skewX;\n  }\n\n  updateSkew() {\n    this._cx = Math.cos(this._rotation + this.skew._y);\n    this._sx = Math.sin(this._rotation + this.skew._y);\n    this._cy = -Math.sin(this._rotation - this.skew._x); // cos, added PI/2\n    this._sy = Math.cos(this._rotation - this.skew._x); // sin, added PI/2\n  }\n\n  updateLocalTransform() {\n    const lt = this.localTransform;\n\n    lt.a = this._cx * this.scale.x;\n    lt.b = this._sx * this.scale.x;\n    lt.c = this._cy * this.scale.y;\n    lt.d = this._sy * this.scale.y;\n\n    lt.tx = this.position.x - (this.pivot.x * lt.a + this.pivot.y * lt.c);\n    lt.ty = this.position.y - (this.pivot.x * lt.b + this.pivot.y * lt.d);\n  }\n\n  updateTransform(parentTransform) {\n    const lt = this.localTransform;\n\n    lt.a = this._cx * this.scale.x;\n    lt.b = this._sx * this.scale.x;\n    lt.c = this._cy * this.scale.y;\n    lt.d = this._sy * this.scale.y;\n\n    lt.tx = this.position.x - (this.pivot.x * lt.a + this.pivot.y * lt.c);\n    lt.ty = this.position.y - (this.pivot.x * lt.b + this.pivot.y * lt.d);\n\n    // concat the parent matrix with the objects transform.\n    const pt = parentTransform.worldTransform;\n    const wt = this.worldTransform;\n\n    wt.a = lt.a * pt.a + lt.b * pt.c;\n    wt.b = lt.a * pt.b + lt.b * pt.d;\n    wt.c = lt.c * pt.a + lt.d * pt.c;\n    wt.d = lt.c * pt.b + lt.d * pt.d;\n    wt.tx = lt.tx * pt.a + lt.ty * pt.c + pt.tx;\n    wt.ty = lt.tx * pt.b + lt.ty * pt.d + pt.ty;\n\n    this._worldID++;\n  }\n\n  setFromMatrix(matrix) {\n    matrix.decompose(this);\n  }\n\n  get rotation() {\n    return this._rotation;\n  }\n\n  set rotation(value) {\n    this._rotation = value;\n    this.updateSkew();\n  }\n}\n"],"mappings":"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"}