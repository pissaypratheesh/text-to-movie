{"version":3,"file":"TransformStatic.js","names":["TransformStatic","TransformBase","constructor","position","ObservablePoint","onChange","scale","pivot","skew","updateSkew","_rotation","_cx","_sx","_cy","_sy","_localID","_currentLocalID","Math","cos","_y","sin","_x","updateLocalTransform","lt","localTransform","a","b","c","d","tx","ty","_parentID","updateTransform","parentTransform","_worldID","pt","worldTransform","wt","setFromMatrix","matrix","decompose","rotation","value"],"sources":["../../src/display/TransformStatic.js"],"sourcesContent":["import { ObservablePoint } from \"../math\";\nimport TransformBase from \"./TransformBase\";\n\nexport default class TransformStatic extends TransformBase {\n  constructor() {\n    super();\n\n    this.position = new ObservablePoint(this.onChange, this, 0, 0);\n    this.scale = new ObservablePoint(this.onChange, this, 1, 1);\n    this.pivot = new ObservablePoint(this.onChange, this, 0, 0);\n    this.skew = new ObservablePoint(this.updateSkew, this, 0, 0);\n    this._rotation = 0;\n\n    this._cx = 1; // cos rotation + skewY;\n    this._sx = 0; // sin rotation + skewY;\n    this._cy = 0; // cos rotation + Math.PI/2 - skewX;\n    this._sy = 1; // sin rotation + Math.PI/2 - skewX;\n\n    this._localID = 0;\n    this._currentLocalID = 0;\n  }\n\n  onChange() {\n    this._localID++;\n  }\n\n  updateSkew() {\n    this._cx = Math.cos(this._rotation + this.skew._y);\n    this._sx = Math.sin(this._rotation + this.skew._y);\n    this._cy = -Math.sin(this._rotation - this.skew._x); // cos, added PI/2\n    this._sy = Math.cos(this._rotation - this.skew._x); // sin, added PI/2\n\n    this._localID++;\n  }\n\n  updateLocalTransform() {\n    const lt = this.localTransform;\n\n    if (this._localID !== this._currentLocalID) {\n      // get the matrix values of the displayobject based on its transform properties..\n      lt.a = this._cx * this.scale._x;\n      lt.b = this._sx * this.scale._x;\n      lt.c = this._cy * this.scale._y;\n      lt.d = this._sy * this.scale._y;\n\n      lt.tx = this.position._x - (this.pivot._x * lt.a + this.pivot._y * lt.c);\n      lt.ty = this.position._y - (this.pivot._x * lt.b + this.pivot._y * lt.d);\n      this._currentLocalID = this._localID;\n\n      // force an update..\n      this._parentID = -1;\n    }\n  }\n\n  updateTransform(parentTransform) {\n    const lt = this.localTransform;\n\n    if (this._localID !== this._currentLocalID) {\n      // get the matrix values of the displayobject based on its transform properties..\n      lt.a = this._cx * this.scale._x;\n      lt.b = this._sx * this.scale._x;\n      lt.c = this._cy * this.scale._y;\n      lt.d = this._sy * this.scale._y;\n\n      lt.tx = this.position._x - (this.pivot._x * lt.a + this.pivot._y * lt.c);\n      lt.ty = this.position._y - (this.pivot._x * lt.b + this.pivot._y * lt.d);\n      this._currentLocalID = this._localID;\n\n      // force an update..\n      this._parentID = -1;\n    }\n\n    if (this._parentID !== parentTransform._worldID) {\n      // concat the parent matrix with the objects transform.\n      const pt = parentTransform.worldTransform;\n      const wt = this.worldTransform;\n\n      wt.a = lt.a * pt.a + lt.b * pt.c;\n      wt.b = lt.a * pt.b + lt.b * pt.d;\n      wt.c = lt.c * pt.a + lt.d * pt.c;\n      wt.d = lt.c * pt.b + lt.d * pt.d;\n      wt.tx = lt.tx * pt.a + lt.ty * pt.c + pt.tx;\n      wt.ty = lt.tx * pt.b + lt.ty * pt.d + pt.ty;\n\n      this._parentID = parentTransform._worldID;\n\n      // update the id of the transform..\n      this._worldID++;\n    }\n  }\n\n  setFromMatrix(matrix) {\n    matrix.decompose(this);\n    this._localID++;\n  }\n\n  get rotation() {\n    return this._rotation;\n  }\n\n  set rotation(value) {\n    if (this._rotation !== value) {\n      this._rotation = value;\n      this.updateSkew();\n    }\n  }\n}\n"],"mappings":"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"}