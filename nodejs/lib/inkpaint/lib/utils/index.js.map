{"version":3,"file":"index.js","names":["nextUid","removeItems","arr","startIdx","removeCount","length","len","i","uid","uuidvx","replace","c","r","Math","random","v","toString","hex2rgb","hex","out","hex2string","substr","rgb2hex","rgb","rgb2hsl","g","b","max","min","h","s","l","d","getResolutionOfUrl","url","defaultValue","undefined","decomposeDataUri","dataUri","dataUriMatch","DATA_URI","exec","mediaType","toLowerCase","subType","charset","encoding","data","getUrlFileExt","extension","URL_FILE_EXTENSION","getSvgSize","svgString","sizeMatch","SVG_SIZE","size","round","parseFloat","sign","n","premultiplyBlendMode","mapPremultipliedBlendModes","correctBlendMode","blendMode","premultiplied","premultiplyTint","tint","alpha","R","G","B","premultiplyRgba","premultiply","Float32Array","premultiplyTintToRgba","inherit","ClassA","ClassB","k","prototype"],"sources":["../../src/utils/index.js"],"sourcesContent":["import earcut from \"earcut\";\nimport * as mixins from \"./mixin\";\nimport EventEmitter from \"eventemitter3\";\nimport pluginTarget from \"./pluginTarget\";\nimport { DATA_URI, URL_FILE_EXTENSION, SVG_SIZE } from \"../const\";\nimport mapPremultipliedBlendModes from \"./mapPremultipliedBlendModes\";\n\nlet nextUid = 0;\nexport { EventEmitter, pluginTarget, mixins, earcut };\n\nexport function removeItems(arr, startIdx, removeCount) {\n  const length = arr.length;\n  if (startIdx >= length || removeCount <= 0 || startIdx < 0) return;\n\n  removeCount =\n    startIdx + removeCount > length ? length - startIdx : removeCount;\n\n  const len = length - removeCount;\n  for (let i = startIdx; i < len; ++i) arr[i] = arr[i + removeCount];\n  arr.length = len;\n}\n\nexport function uid() {\n  return ++nextUid;\n}\n\nexport function uuidvx() {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx\".replace(/[xy]/g, c => {\n    const r = (Math.random() * 16) | 0;\n    const v = c === \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport function hex2rgb(hex, out) {\n  out = out || [];\n  out[0] = ((hex >> 16) & 0xff) / 255;\n  out[1] = ((hex >> 8) & 0xff) / 255;\n  out[2] = (hex & 0xff) / 255;\n\n  return out;\n}\n\nexport function hex2string(hex) {\n  hex = hex.toString(16);\n  hex = \"000000\".substr(0, 6 - hex.length) + hex;\n  return `#${hex}`;\n}\n\nexport function rgb2hex(rgb) {\n  return ((rgb[0] * 255) << 16) + ((rgb[1] * 255) << 8) + ((rgb[2] * 255) | 0);\n}\n\nexport function rgb2hsl(r, g, b) {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  let max = Math.max(r, g, b),\n    min = Math.min(r, g, b);\n\n  let h,\n    s,\n    l = (max + min) / 2;\n\n  if (max == min) {\n    h = s = 0; // achromatic\n  } else {\n    let d = max - min;\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n    switch (max) {\n      case r:\n        h = (g - b) / d + (g < b ? 6 : 0);\n        break;\n      case g:\n        h = (b - r) / d + 2;\n        break;\n      case b:\n        h = (r - g) / d + 4;\n        break;\n    }\n\n    h /= 6;\n  }\n\n  h *= 360;\n  s *= 100;\n  l *= 100;\n  return [h, s, l];\n}\n\nexport function getResolutionOfUrl(url, defaultValue) {\n  return defaultValue !== undefined ? defaultValue : 1;\n}\n\nexport function decomposeDataUri(dataUri) {\n  const dataUriMatch = DATA_URI.exec(dataUri);\n\n  if (dataUriMatch) {\n    return {\n      mediaType: dataUriMatch[1] ? dataUriMatch[1].toLowerCase() : undefined,\n      subType: dataUriMatch[2] ? dataUriMatch[2].toLowerCase() : undefined,\n      charset: dataUriMatch[3] ? dataUriMatch[3].toLowerCase() : undefined,\n      encoding: dataUriMatch[4] ? dataUriMatch[4].toLowerCase() : undefined,\n      data: dataUriMatch[5]\n    };\n  }\n\n  return undefined;\n}\n\nexport function getUrlFileExt(url) {\n  const extension = URL_FILE_EXTENSION.exec(url);\n  if (extension) return extension[1].toLowerCase();\n  return undefined;\n}\n\nexport function getSvgSize(svgString) {\n  const sizeMatch = SVG_SIZE.exec(svgString);\n  const size = {};\n\n  if (sizeMatch) {\n    size[sizeMatch[1]] = Math.round(parseFloat(sizeMatch[3]));\n    size[sizeMatch[5]] = Math.round(parseFloat(sizeMatch[7]));\n  }\n\n  return size;\n}\n\nexport function sign(n) {\n  if (n === 0) return 0;\n  return n < 0 ? -1 : 1;\n}\n\nexport const premultiplyBlendMode = mapPremultipliedBlendModes();\n\nexport function correctBlendMode(blendMode, premultiplied) {\n  return premultiplyBlendMode[premultiplied ? 1 : 0][blendMode];\n}\n\nexport function premultiplyTint(tint, alpha) {\n  if (alpha === 1.0) {\n    return ((alpha * 255) << 24) + tint;\n  }\n  if (alpha === 0.0) {\n    return 0;\n  }\n  let R = (tint >> 16) & 0xff;\n  let G = (tint >> 8) & 0xff;\n  let B = tint & 0xff;\n\n  R = (R * alpha + 0.5) | 0;\n  G = (G * alpha + 0.5) | 0;\n  B = (B * alpha + 0.5) | 0;\n\n  return ((alpha * 255) << 24) + (R << 16) + (G << 8) + B;\n}\n\nexport function premultiplyRgba(rgb, alpha, out, premultiply) {\n  out = out || new Float32Array(4);\n  if (premultiply || premultiply === undefined) {\n    out[0] = rgb[0] * alpha;\n    out[1] = rgb[1] * alpha;\n    out[2] = rgb[2] * alpha;\n  } else {\n    out[0] = rgb[0];\n    out[1] = rgb[1];\n    out[2] = rgb[2];\n  }\n  out[3] = alpha;\n\n  return out;\n}\n\nexport function premultiplyTintToRgba(tint, alpha, out, premultiply) {\n  out = out || new Float32Array(4);\n  out[0] = ((tint >> 16) & 0xff) / 255.0;\n  out[1] = ((tint >> 8) & 0xff) / 255.0;\n  out[2] = (tint & 0xff) / 255.0;\n  if (premultiply || premultiply === undefined) {\n    out[0] *= alpha;\n    out[1] *= alpha;\n    out[2] *= alpha;\n  }\n  out[3] = alpha;\n\n  return out;\n}\n\nexport function inherit(ClassA, ClassB) {\n  for (const k in ClassB.prototype) {\n    ClassA.prototype[k] = ClassB.prototype[k];\n  }\n}\n"],"mappings":"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"}