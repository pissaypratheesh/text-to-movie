{"version":3,"file":"buildRoundedRectangle.js","names":["buildRoundedRectangle","graphicsData","webGLData","webGLDataNativeLines","rrectData","shape","x","y","width","height","radius","recPoints","push","quadraticBezierCurve","fill","color","hex2rgb","fillColor","alpha","fillAlpha","r","g","b","verts","points","indices","vecPos","length","triangles","earcut","i","j","lineWidth","tempPoints","buildLine","getPt","n1","n2","perc","diff","fromX","fromY","cpX","cpY","toX","toY","out","n","xa","ya","xb","yb"],"sources":["../../../../src/graphics/webgl/utils/buildRoundedRectangle.js"],"sourcesContent":["import earcut from 'earcut';\nimport buildLine from './buildLine';\nimport { hex2rgb } from '../../../utils';\n\n/**\n * Builds a rounded rectangle to draw\n *\n * Ignored from docs since it is not directly exposed.\n *\n * @ignore\n * @private\n * @param {InkPaint.WebGLGraphicsData} graphicsData - The graphics object containing all the necessary properties\n * @param {object} webGLData - an object containing all the webGL-specific information to create this shape\n * @param {object} webGLDataNativeLines - an object containing all the webGL-specific information to create nativeLines\n */\nexport default function buildRoundedRectangle(graphicsData, webGLData, webGLDataNativeLines)\n{\n    const rrectData = graphicsData.shape;\n    const x = rrectData.x;\n    const y = rrectData.y;\n    const width = rrectData.width;\n    const height = rrectData.height;\n\n    const radius = rrectData.radius;\n\n    const recPoints = [];\n\n    recPoints.push(x + radius, y);\n    quadraticBezierCurve(x + width - radius, y, x + width, y, x + width, y + radius, recPoints);\n    quadraticBezierCurve(x + width, y + height - radius, x + width, y + height, x + width - radius, y + height, recPoints);\n    quadraticBezierCurve(x + radius, y + height, x, y + height, x, y + height - radius, recPoints);\n    quadraticBezierCurve(x, y + radius, x, y, x + radius + 0.0000000001, y, recPoints);\n\n    // this tiny number deals with the issue that occurs when points overlap and earcut fails to triangulate the item.\n    // TODO - fix this properly, this is not very elegant.. but it works for now.\n\n    if (graphicsData.fill)\n    {\n        const color = hex2rgb(graphicsData.fillColor);\n        const alpha = graphicsData.fillAlpha;\n\n        const r = color[0] * alpha;\n        const g = color[1] * alpha;\n        const b = color[2] * alpha;\n\n        const verts = webGLData.points;\n        const indices = webGLData.indices;\n\n        const vecPos = verts.length / 6;\n\n        const triangles = earcut(recPoints, null, 2);\n\n        for (let i = 0, j = triangles.length; i < j; i += 3)\n        {\n            indices.push(triangles[i] + vecPos);\n            indices.push(triangles[i] + vecPos);\n            indices.push(triangles[i + 1] + vecPos);\n            indices.push(triangles[i + 2] + vecPos);\n            indices.push(triangles[i + 2] + vecPos);\n        }\n\n        for (let i = 0, j = recPoints.length; i < j; i++)\n        {\n            verts.push(recPoints[i], recPoints[++i], r, g, b, alpha);\n        }\n    }\n\n    if (graphicsData.lineWidth)\n    {\n        const tempPoints = graphicsData.points;\n\n        graphicsData.points = recPoints;\n\n        buildLine(graphicsData, webGLData, webGLDataNativeLines);\n\n        graphicsData.points = tempPoints;\n    }\n}\n\n/**\n * Calculate a single point for a quadratic bezier curve.\n * Utility function used by quadraticBezierCurve.\n * Ignored from docs since it is not directly exposed.\n *\n * @ignore\n * @private\n * @param {number} n1 - first number\n * @param {number} n2 - second number\n * @param {number} perc - percentage\n * @return {number} the result\n *\n */\nfunction getPt(n1, n2, perc)\n{\n    const diff = n2 - n1;\n\n    return n1 + (diff * perc);\n}\n\n/**\n * Calculate the points for a quadratic bezier curve. (helper function..)\n * Based on: https://stackoverflow.com/questions/785097/how-do-i-implement-a-bezier-curve-in-c\n *\n * Ignored from docs since it is not directly exposed.\n *\n * @ignore\n * @private\n * @param {number} fromX - Origin point x\n * @param {number} fromY - Origin point x\n * @param {number} cpX - Control point x\n * @param {number} cpY - Control point y\n * @param {number} toX - Destination point x\n * @param {number} toY - Destination point y\n * @param {number[]} [out=[]] - The output array to add points into. If not passed, a new array is created.\n * @return {number[]} an array of points\n */\nfunction quadraticBezierCurve(fromX, fromY, cpX, cpY, toX, toY, out = [])\n{\n    const n = 20;\n    const points = out;\n\n    let xa = 0;\n    let ya = 0;\n    let xb = 0;\n    let yb = 0;\n    let x = 0;\n    let y = 0;\n\n    for (let i = 0, j = 0; i <= n; ++i)\n    {\n        j = i / n;\n\n        // The Green Line\n        xa = getPt(fromX, cpX, j);\n        ya = getPt(fromY, cpY, j);\n        xb = getPt(cpX, toX, j);\n        yb = getPt(cpY, toY, j);\n\n        // The Black Dot\n        x = getPt(xa, xb, j);\n        y = getPt(ya, yb, j);\n\n        points.push(x, y);\n    }\n\n    return points;\n}\n"],"mappings":"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"}