{"version":3,"file":"BlurXFilter.js","names":["BlurXFilter","Filter","constructor","strength","quality","resolution","kernelSize","vertSrc","generateBlurVertSource","fragSrc","generateBlurFragSource","settings","RESOLUTION","_quality","firstRun","apply","filterManager","input","output","clear","gl","renderer","getMaxBlurKernelSize","vertexSrc","fragmentSrc","uniforms","size","width","passes","applyFilter","renderTarget","getRenderTarget","flip","flop","i","temp","returnRenderTarget","blur","value","padding","Math","abs"],"sources":["../../../src/filters/blur/BlurXFilter.js"],"sourcesContent":["import settings from \"../../settings\";\nimport Filter from \"../../renderers/webgl/filters/Filter\";\nimport generateBlurVertSource from \"./generateBlurVertSource\";\nimport generateBlurFragSource from \"./generateBlurFragSource\";\nimport getMaxBlurKernelSize from \"./getMaxBlurKernelSize\";\n\nexport default class BlurXFilter extends Filter {\n  constructor(strength, quality, resolution, kernelSize) {\n    kernelSize = kernelSize || 5;\n    const vertSrc = generateBlurVertSource(kernelSize, true);\n    const fragSrc = generateBlurFragSource(kernelSize);\n\n    super(\n      // vertex shader\n      vertSrc,\n      // fragment shader\n      fragSrc\n    );\n\n    this.resolution = resolution || settings.RESOLUTION;\n\n    this._quality = 0;\n\n    this.quality = quality || 4;\n    this.strength = strength || 8;\n\n    this.firstRun = true;\n  }\n\n  apply(filterManager, input, output, clear) {\n    if (this.firstRun) {\n      const gl = filterManager.renderer.gl;\n      const kernelSize = getMaxBlurKernelSize(gl);\n\n      this.vertexSrc = generateBlurVertSource(kernelSize, true);\n      this.fragmentSrc = generateBlurFragSource(kernelSize);\n\n      this.firstRun = false;\n    }\n\n    this.uniforms.strength =\n      (1 / output.size.width) * (output.size.width / input.size.width);\n\n    // screen space!\n    this.uniforms.strength *= this.strength;\n    this.uniforms.strength /= this.passes; // / this.passes//Math.pow(1, this.passes);\n\n    if (this.passes === 1) {\n      filterManager.applyFilter(this, input, output, clear);\n    } else {\n      const renderTarget = filterManager.getRenderTarget(true);\n      let flip = input;\n      let flop = renderTarget;\n\n      for (let i = 0; i < this.passes - 1; i++) {\n        filterManager.applyFilter(this, flip, flop, true);\n\n        const temp = flop;\n\n        flop = flip;\n        flip = temp;\n      }\n\n      filterManager.applyFilter(this, flip, output, clear);\n\n      filterManager.returnRenderTarget(renderTarget);\n    }\n  }\n\n  get blur() {\n    return this.strength;\n  }\n\n  set blur(value) {\n    this.padding = Math.abs(value) * 2;\n    this.strength = value;\n  }\n\n  get quality() {\n    return this._quality;\n  }\n\n  set quality(value) {\n    this._quality = value;\n    this.passes = value;\n  }\n}\n"],"mappings":"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"}