{"version":3,"file":"DisplacementFilter.js","names":["DisplacementFilter","core","Filter","constructor","sprite","scale","maskMatrix","Matrix","renderable","maskSprite","uniforms","mapSampler","_texture","filterMatrix","x","y","undefined","Point","apply","filterManager","input","output","calculateSpriteMatrix","applyFilter","map","value"],"sources":["../../../src/filters/displacement/DisplacementFilter.js"],"sourcesContent":["import * as core from \"../../core\";\nimport { readFileSync } from \"fs\";\nimport { join } from \"path\";\n\nexport default class DisplacementFilter extends core.Filter {\n  constructor(sprite, scale) {\n    const maskMatrix = new core.Matrix();\n\n    sprite.renderable = false;\n\n    super(\n      // vertex shader\n      readFileSync(\n        join(__dirname, \"../fragments/default-filter-matrix.vert\"),\n        \"utf8\"\n      ),\n      // fragment shader\n      readFileSync(join(__dirname, \"./displacement.frag\"), \"utf8\")\n    );\n\n    this.maskSprite = sprite;\n    this.maskMatrix = maskMatrix;\n\n    this.uniforms.mapSampler = sprite._texture;\n    this.uniforms.filterMatrix = maskMatrix;\n    this.uniforms.scale = { x: 1, y: 1 };\n\n    if (scale === null || scale === undefined) {\n      scale = 20;\n    }\n\n    this.scale = new core.Point(scale, scale);\n  }\n\n  apply(filterManager, input, output) {\n    this.uniforms.filterMatrix = filterManager.calculateSpriteMatrix(\n      this.maskMatrix,\n      this.maskSprite\n    );\n    this.uniforms.scale.x = this.scale.x;\n    this.uniforms.scale.y = this.scale.y;\n\n    // draw the filter...\n    filterManager.applyFilter(this, input, output);\n  }\n\n  get map() {\n    return this.uniforms.mapSampler;\n  }\n\n  set map(value) {\n    this.uniforms.mapSampler = value;\n  }\n}\n"],"mappings":";;;;;;AAAA;AAEA;AAA4B;AAAA;AAEb,MAAMA,kBAAkB,SAASC,IAAI,CAACC,MAAM,CAAC;EAC1DC,WAAW,CAACC,MAAM,EAAEC,KAAK,EAAE;IACzB,IAAMC,UAAU,GAAG,IAAIL,IAAI,CAACM,MAAM,EAAE;IAEpCH,MAAM,CAACI,UAAU,GAAG,KAAK;IAEzB,KAAK,EACH;IAAA,kZAKA;IAAA,kdAED;IAED,IAAI,CAACC,UAAU,GAAGL,MAAM;IACxB,IAAI,CAACE,UAAU,GAAGA,UAAU;IAE5B,IAAI,CAACI,QAAQ,CAACC,UAAU,GAAGP,MAAM,CAACQ,QAAQ;IAC1C,IAAI,CAACF,QAAQ,CAACG,YAAY,GAAGP,UAAU;IACvC,IAAI,CAACI,QAAQ,CAACL,KAAK,GAAG;MAAES,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC;IAEpC,IAAIV,KAAK,KAAK,IAAI,IAAIA,KAAK,KAAKW,SAAS,EAAE;MACzCX,KAAK,GAAG,EAAE;IACZ;IAEA,IAAI,CAACA,KAAK,GAAG,IAAIJ,IAAI,CAACgB,KAAK,CAACZ,KAAK,EAAEA,KAAK,CAAC;EAC3C;EAEAa,KAAK,CAACC,aAAa,EAAEC,KAAK,EAAEC,MAAM,EAAE;IAClC,IAAI,CAACX,QAAQ,CAACG,YAAY,GAAGM,aAAa,CAACG,qBAAqB,CAC9D,IAAI,CAAChB,UAAU,EACf,IAAI,CAACG,UAAU,CAChB;IACD,IAAI,CAACC,QAAQ,CAACL,KAAK,CAACS,CAAC,GAAG,IAAI,CAACT,KAAK,CAACS,CAAC;IACpC,IAAI,CAACJ,QAAQ,CAACL,KAAK,CAACU,CAAC,GAAG,IAAI,CAACV,KAAK,CAACU,CAAC;;IAEpC;IACAI,aAAa,CAACI,WAAW,CAAC,IAAI,EAAEH,KAAK,EAAEC,MAAM,CAAC;EAChD;EAEA,IAAIG,GAAG,GAAG;IACR,OAAO,IAAI,CAACd,QAAQ,CAACC,UAAU;EACjC;EAEA,IAAIa,GAAG,CAACC,KAAK,EAAE;IACb,IAAI,CAACf,QAAQ,CAACC,UAAU,GAAGc,KAAK;EAClC;AACF;AAAC"}