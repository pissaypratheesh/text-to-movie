{"version":3,"file":"Resource.js","names":["_noop","EMPTY_GIF","Resource","constructor","name","url","options","Error","_flags","setflag","STATUS_FLAGS","DATA_URL","indexOf","extension","_getExt","data","crossOrigin","timeout","loadType","_determineLoadType","xhrType","error","children","type","TYPE","UNKNOWN","progressChunk","_dequeue","_onLoadBinding","_elementTimer","metadata","onStart","Signal","onProgress","onComplete","onAfterMiddleware","_onComplete","bind","_onError","_onTimeout","_onXhrLoad","isDataUrl","hasflag","isComplete","COMPLETE","isLoading","LOADING","complete","_clearEvents","_finish","load","cb","setTimeout","once","dispatch","LOAD_TYPE","IMAGE","_loadImage","XHR","_loadOtherFile","abort","message","src","firstChild","removeChild","destroy","removeHandler","isNetWork","_isNetWork","isBrowser","_loadXhr","_loadLocalFile","readFile","err","body","JSON","parse","superagent","get","end","res","test","flag","value","onerror","onload","clearTimeout","PsImage","network","event","e","LOAD_TYPE_MAP","ext","slashIndex","substring","queryStart","hashStart","index","Math","min","length","lastIndexOf","toLowerCase","setExtensionLoadType","extname","setExtMap","setExtensionXhrType","XHR_TYPE_MAP","XML","AUDIO","VIDEO","TEXT","map","val"],"sources":["../../src/resource/Resource.js"],"sourcesContent":["import { readFile } from \"fs\";\nimport Signal from \"mini-signals\";\nimport superagent from \"superagent\";\nimport PsImage from \"../polyfill/Image\";\nimport { isBrowser } from \"browser-or-node\";\nimport {\n  STATUS_FLAGS,\n  LOAD_TYPE,\n  XHR_TYPE_MAP,\n  LOAD_TYPE_MAP\n} from \"./constant\";\n\nfunction _noop() {}\nconst EMPTY_GIF =\n  \"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\";\n\nexport default class Resource {\n  constructor(name, url, options = {}) {\n    if (typeof name !== \"string\" || typeof url !== \"string\") {\n      throw new Error(\"Both name and url are required.\");\n    }\n\n    this._flags = 0;\n    this.setflag(STATUS_FLAGS.DATA_URL, url.indexOf(\"data:\") === 0);\n\n    this.name = name;\n    this.url = url;\n    this.extension = this._getExt();\n    this.data = null;\n    this.crossOrigin =\n      options.crossOrigin === true ? \"anonymous\" : options.crossOrigin;\n\n    this.timeout = options.timeout || 0;\n    this.loadType = options.loadType || this._determineLoadType();\n    this.xhrType = options.xhrType;\n\n    this.error = null;\n    this.children = [];\n    this.type = Resource.TYPE.UNKNOWN;\n    this.progressChunk = 0;\n    this._dequeue = _noop;\n    this._onLoadBinding = null;\n    this._elementTimer = 0;\n\n    this.metadata = options.metadata || {};\n    this.onStart = new Signal();\n    this.onProgress = new Signal();\n    this.onComplete = new Signal();\n    this.onAfterMiddleware = new Signal();\n\n    this._onComplete = this._onComplete.bind(this);\n    this._onError = this._onError.bind(this);\n    this._onTimeout = this._onTimeout.bind(this);\n    this._onXhrLoad = this._onXhrLoad.bind(this);\n  }\n\n  get isDataUrl() {\n    return this.hasflag(STATUS_FLAGS.DATA_URL);\n  }\n\n  get isComplete() {\n    return this.hasflag(STATUS_FLAGS.COMPLETE);\n  }\n\n  get isLoading() {\n    return this.hasflag(STATUS_FLAGS.LOADING);\n  }\n\n  complete() {\n    this._clearEvents();\n    this._finish();\n  }\n\n  load(cb) {\n    const { isLoading, loadType, isComplete } = this;\n\n    if (isLoading) return;\n    if (isComplete) {\n      if (cb) setTimeout(() => cb(this), 1);\n      return;\n    } else if (cb) {\n      this.onComplete.once(cb);\n    }\n\n    this.setflag(STATUS_FLAGS.LOADING, true);\n    this.onStart.dispatch(this);\n\n    switch (loadType) {\n      case LOAD_TYPE.IMAGE:\n        this.type = Resource.TYPE.IMAGE;\n        this._loadImage();\n        break;\n\n      case LOAD_TYPE.XHR:\n      default:\n        this._loadOtherFile();\n        break;\n    }\n  }\n\n  abort(message) {\n    if (this.error) return;\n    this.error = new Error(message);\n    this._clearEvents();\n\n    if (this.data) {\n      // single source\n      if (this.data.src) {\n        this.data.src = EMPTY_GIF;\n      }\n\n      // multi-source\n      else {\n        while (this.data.firstChild) {\n          this.data.removeChild(this.data.firstChild);\n        }\n      }\n    }\n\n    this._finish();\n  }\n\n  destroy() {\n    this.removeHandler();\n    this.data = null;\n    this.name = null;\n    this.url = null;\n    this.metadata = null;\n    this.onStart = null;\n    this.onProgress = null;\n    this.onComplete = null;\n    this.onAfterMiddleware = null;\n\n    this.children = null;\n    this._dequeue = null;\n    this._onLoadBinding = null;\n    this._flags = 0;\n    this._onComplete = null;\n    this._onError = null;\n    this._onTimeout = null;\n    this._onXhrLoad = null;\n  }\n\n  _loadOtherFile() {\n    const isNetWork = this._isNetWork(this.url);\n    if (isNetWork || isBrowser) {\n      this._loadXhr();\n    } else {\n      this._loadLocalFile();\n    }\n  }\n\n  _loadLocalFile() {\n    readFile(this.url, (err, data) => {\n      if (err) {\n        this._onError(err);\n      } else {\n        const body = JSON.parse(data);\n        this._onXhrLoad(body);\n      }\n    });\n  }\n\n  _loadXhr() {\n    superagent.get(this.url).end((err, res) => {\n      if (err) {\n        this._onError(err);\n      } else {\n        this._onXhrLoad(res.body);\n      }\n    });\n  }\n\n  _isNetWork(url) {\n    if (/^\\s*https?:\\/\\//.test(url)) return true;\n    return false;\n  }\n\n  _onXhrLoad(data) {\n    this.data = data;\n    this.type = Resource.TYPE.JSON;\n    this.complete();\n  }\n\n  hasflag(flag) {\n    return (this._flags & flag) !== 0;\n  }\n\n  setflag(flag, value) {\n    this._flags = value ? this._flags | flag : this._flags & ~flag;\n  }\n\n  removeHandler() {\n    if (!this.data) return;\n    this.data.onerror = null;\n    this.data.onload = null;\n  }\n\n  _clearEvents() {\n    clearTimeout(this._elementTimer);\n    this.removeHandler();\n  }\n\n  _finish() {\n    if (this.isComplete) return;\n    this.setflag(STATUS_FLAGS.COMPLETE, true);\n    this.setflag(STATUS_FLAGS.LOADING, false);\n    this.onComplete.dispatch(this);\n  }\n\n  _loadImage() {\n    this.data = new PsImage();\n    this.data.onerror = this._onError;\n    this.data.onload = this._onComplete;\n    if (this.crossOrigin) this.data.crossOrigin = this.crossOrigin;\n\n    this.data.src = this.url;\n    if (this._isNetWork(this.url)) {\n      this.data.network = true;\n    } else {\n      this.data.network = false;\n    }\n\n    if (this.timeout) {\n      this._elementTimer = setTimeout(this._onTimeout, this.timeout);\n    }\n  }\n\n  _onError(event) {\n    this.abort(`Failed to load element using: ${event}`);\n  }\n\n  _onTimeout() {\n    this.abort(`Load timed out.`);\n  }\n\n  _onComplete(e) {\n    this.complete();\n  }\n\n  _determineLoadType() {\n    return LOAD_TYPE_MAP[this.extension] || LOAD_TYPE.XHR;\n  }\n\n  _getExt() {\n    let url = this.url;\n    let ext = \"\";\n\n    if (this.isDataUrl) {\n      const slashIndex = url.indexOf(\"/\");\n      ext = url.substring(slashIndex + 1, url.indexOf(\";\", slashIndex));\n    } else {\n      const queryStart = url.indexOf(\"?\");\n      const hashStart = url.indexOf(\"#\");\n      const index = Math.min(\n        queryStart > -1 ? queryStart : url.length,\n        hashStart > -1 ? hashStart : url.length\n      );\n      url = url.substring(0, index);\n      ext = url.substring(url.lastIndexOf(\".\") + 1);\n    }\n\n    return ext.toLowerCase();\n  }\n\n  static setExtensionLoadType(extname, loadType) {\n    setExtMap(LOAD_TYPE_MAP, extname, loadType);\n  }\n\n  static setExtensionXhrType(extname, xhrType) {\n    setExtMap(XHR_TYPE_MAP, extname, xhrType);\n  }\n}\n\nResource.TYPE = {\n  UNKNOWN: 0,\n  JSON: 1,\n  XML: 2,\n  IMAGE: 3,\n  AUDIO: 4,\n  VIDEO: 5,\n  TEXT: 6\n};\n\nfunction setExtMap(map, extname, val) {\n  if (extname && extname.indexOf(\".\") === 0) {\n    extname = extname.substring(1);\n  }\n\n  if (!extname) {\n    return;\n  }\n\n  map[extname] = val;\n}\n"],"mappings":"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"}