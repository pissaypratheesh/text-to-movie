{"version":3,"file":"Quad.js","names":["Quad","constructor","gl","state","vertices","Float32Array","uvs","interleaved","i","indices","createIndicesForQuads","vertexBuffer","glCore","GLBuffer","createVertexBuffer","STATIC_DRAW","indexBuffer","createIndexBuffer","vao","VertexArrayObject","initVao","shader","clear","addIndex","addAttribute","attributes","aVertexPosition","FLOAT","aTextureCoord","map","targetTextureFrame","destinationFrame","x","y","width","height","upload","destroy","deleteBuffer"],"sources":["../../../../src/renderers/webgl/utils/Quad.js"],"sourcesContent":["import glCore from \"pixi-gl-core\";\nimport createIndicesForQuads from \"../../../utils/createIndicesForQuads\";\n\nexport default class Quad {\n  constructor(gl, state) {\n    this.gl = gl;\n    this.vertices = new Float32Array([-1, -1, 1, -1, 1, 1, -1, 1]);\n    this.uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);\n    this.interleaved = new Float32Array(8 * 2);\n\n    for (let i = 0; i < 4; i++) {\n      this.interleaved[i * 4] = this.vertices[i * 2];\n      this.interleaved[i * 4 + 1] = this.vertices[i * 2 + 1];\n      this.interleaved[i * 4 + 2] = this.uvs[i * 2];\n      this.interleaved[i * 4 + 3] = this.uvs[i * 2 + 1];\n    }\n\n    this.indices = createIndicesForQuads(1);\n    this.vertexBuffer = glCore.GLBuffer.createVertexBuffer(\n      gl,\n      this.interleaved,\n      gl.STATIC_DRAW\n    );\n    this.indexBuffer = glCore.GLBuffer.createIndexBuffer(\n      gl,\n      this.indices,\n      gl.STATIC_DRAW\n    );\n\n    this.vao = new glCore.VertexArrayObject(gl, state);\n  }\n\n  initVao(shader) {\n    this.vao\n      .clear()\n      .addIndex(this.indexBuffer)\n      .addAttribute(\n        this.vertexBuffer,\n        shader.attributes.aVertexPosition,\n        this.gl.FLOAT,\n        false,\n        4 * 4,\n        0\n      )\n      .addAttribute(\n        this.vertexBuffer,\n        shader.attributes.aTextureCoord,\n        this.gl.FLOAT,\n        false,\n        4 * 4,\n        2 * 4\n      );\n  }\n\n  map(targetTextureFrame, destinationFrame) {\n    let x = 0; // destinationFrame.x / targetTextureFrame.width;\n    let y = 0; // destinationFrame.y / targetTextureFrame.height;\n\n    this.uvs[0] = x;\n    this.uvs[1] = y;\n\n    this.uvs[2] = x + destinationFrame.width / targetTextureFrame.width;\n    this.uvs[3] = y;\n\n    this.uvs[4] = x + destinationFrame.width / targetTextureFrame.width;\n    this.uvs[5] = y + destinationFrame.height / targetTextureFrame.height;\n\n    this.uvs[6] = x;\n    this.uvs[7] = y + destinationFrame.height / targetTextureFrame.height;\n\n    x = destinationFrame.x;\n    y = destinationFrame.y;\n\n    this.vertices[0] = x;\n    this.vertices[1] = y;\n\n    this.vertices[2] = x + destinationFrame.width;\n    this.vertices[3] = y;\n\n    this.vertices[4] = x + destinationFrame.width;\n    this.vertices[5] = y + destinationFrame.height;\n\n    this.vertices[6] = x;\n    this.vertices[7] = y + destinationFrame.height;\n\n    return this;\n  }\n\n  upload() {\n    for (let i = 0; i < 4; i++) {\n      this.interleaved[i * 4] = this.vertices[i * 2];\n      this.interleaved[i * 4 + 1] = this.vertices[i * 2 + 1];\n      this.interleaved[i * 4 + 2] = this.uvs[i * 2];\n      this.interleaved[i * 4 + 3] = this.uvs[i * 2 + 1];\n    }\n\n    this.vertexBuffer.upload(this.interleaved);\n    return this;\n  }\n\n  destroy() {\n    const gl = this.gl;\n    gl.deleteBuffer(this.vertexBuffer);\n    gl.deleteBuffer(this.indexBuffer);\n  }\n}\n"],"mappings":"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"}