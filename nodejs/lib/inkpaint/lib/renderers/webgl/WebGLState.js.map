{"version":3,"file":"WebGLState.js","names":["BLEND","DEPTH_TEST","FRONT_FACE","CULL_FACE","BLEND_FUNC","WebGLState","constructor","gl","activeState","Uint8Array","defaultState","stackIndex","stack","maxAttribs","getParameter","MAX_VERTEX_ATTRIBS","attribState","tempAttribState","Array","blendModes","mapWebGLBlendModesToPixi","nativeVaoExtension","getExtension","push","state","i","length","pop","setState","setBlend","setDepthTest","setFrontFace","setCullFace","setBlendMode","value","mode","blendFunc","blendFuncSeparate","frontFace","resetAttributes","disableVertexAttribArray","resetToDefault","bindVertexArrayOES","pixelStorei","UNPACK_FLIP_Y_WEBGL"],"sources":["../../../src/renderers/webgl/WebGLState.js"],"sourcesContent":["import mapWebGLBlendModesToPixi from \"./utils/mapWebGLBlendModesToPixi\";\n\nconst BLEND = 0;\nconst DEPTH_TEST = 1;\nconst FRONT_FACE = 2;\nconst CULL_FACE = 3;\nconst BLEND_FUNC = 4;\n\nexport default class WebGLState {\n  constructor(gl) {\n    this.activeState = new Uint8Array(16);\n    this.defaultState = new Uint8Array(16);\n    this.defaultState[0] = 1;\n    this.stackIndex = 0;\n    this.stack = [];\n    this.gl = gl;\n\n    this.maxAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n    this.attribState = {\n      tempAttribState: new Array(this.maxAttribs),\n      attribState: new Array(this.maxAttribs)\n    };\n\n    this.blendModes = mapWebGLBlendModesToPixi(gl);\n    this.nativeVaoExtension =\n      gl.getExtension(\"OES_vertex_array_object\") ||\n      gl.getExtension(\"MOZ_OES_vertex_array_object\") ||\n      gl.getExtension(\"WEBKIT_OES_vertex_array_object\");\n  }\n\n  push() {\n    let state = this.stack[this.stackIndex];\n\n    if (!state) {\n      state = this.stack[this.stackIndex] = new Uint8Array(16);\n    }\n\n    ++this.stackIndex;\n    for (let i = 0; i < this.activeState.length; i++) {\n      state[i] = this.activeState[i];\n    }\n  }\n\n  pop() {\n    const state = this.stack[--this.stackIndex];\n    this.setState(state);\n  }\n\n  setState(state) {\n    this.setBlend(state[BLEND]);\n    this.setDepthTest(state[DEPTH_TEST]);\n    this.setFrontFace(state[FRONT_FACE]);\n    this.setCullFace(state[CULL_FACE]);\n    this.setBlendMode(state[BLEND_FUNC]);\n  }\n\n  setBlend(value) {\n    value = value ? 1 : 0;\n    if (this.activeState[BLEND] === value) {\n      return;\n    }\n\n    this.activeState[BLEND] = value;\n    this.gl[value ? \"enable\" : \"disable\"](this.gl.BLEND);\n  }\n\n  setBlendMode(value) {\n    if (value === this.activeState[BLEND_FUNC]) {\n      return;\n    }\n\n    this.activeState[BLEND_FUNC] = value;\n\n    const mode = this.blendModes[value];\n\n    if (mode.length === 2) {\n      this.gl.blendFunc(mode[0], mode[1]);\n    } else {\n      this.gl.blendFuncSeparate(mode[0], mode[1], mode[2], mode[3]);\n    }\n  }\n\n  setDepthTest(value) {\n    value = value ? 1 : 0;\n\n    if (this.activeState[DEPTH_TEST] === value) {\n      return;\n    }\n\n    this.activeState[DEPTH_TEST] = value;\n    this.gl[value ? \"enable\" : \"disable\"](this.gl.DEPTH_TEST);\n  }\n\n  setCullFace(value) {\n    value = value ? 1 : 0;\n\n    if (this.activeState[CULL_FACE] === value) {\n      return;\n    }\n\n    this.activeState[CULL_FACE] = value;\n    this.gl[value ? \"enable\" : \"disable\"](this.gl.CULL_FACE);\n  }\n\n  setFrontFace(value) {\n    value = value ? 1 : 0;\n\n    if (this.activeState[FRONT_FACE] === value) {\n      return;\n    }\n\n    this.activeState[FRONT_FACE] = value;\n    this.gl.frontFace(this.gl[value ? \"CW\" : \"CCW\"]);\n  }\n\n  resetAttributes() {\n    for (let i = 0; i < this.attribState.tempAttribState.length; i++) {\n      this.attribState.tempAttribState[i] = 0;\n    }\n\n    for (let i = 0; i < this.attribState.attribState.length; i++) {\n      this.attribState.attribState[i] = 0;\n    }\n\n    // im going to assume one is always active for performance reasons.\n    for (let i = 1; i < this.maxAttribs; i++) {\n      this.gl.disableVertexAttribArray(i);\n    }\n  }\n\n  resetToDefault() {\n    // unbind any VAO if they exist..\n    if (this.nativeVaoExtension) {\n      this.nativeVaoExtension.bindVertexArrayOES(null);\n    }\n\n    // reset all attributes..\n    this.resetAttributes();\n\n    // set active state so we can force overrides of gl state\n    for (let i = 0; i < this.activeState.length; ++i) {\n      this.activeState[i] = 32;\n    }\n\n    this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, false);\n\n    this.setState(this.defaultState);\n  }\n}\n"],"mappings":"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"}